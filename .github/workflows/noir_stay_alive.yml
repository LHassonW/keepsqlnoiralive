name: Keep Noir Website Alive

on:
  schedule:
    - cron: '0 5 * * *'
  workflow_dispatch:

jobs:
  ping_site:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Run Visit
        id: visit
        run: |
          npm install playwright
          npx playwright install chromium --with-deps
          # Run the script and capture the output
          node keep_alive_noir.js > output.log 2>&1 || true
          cat output.log
          
          # Check if the log contains the failure message we defined
          if grep -q "ALARM: SITE IS DOWN" output.log; then
            echo "RESULT=ðŸš¨ FAILED BUT MARKED SUCCESS" >> $GITHUB_ENV
          else
            echo "RESULT=âœ… ACTUAL SUCCESS" >> $GITHUB_ENV
          fi

      - name: Summary Report
        run: |
          echo "Run Result: ${{ env.RESULT }}"
